sudo: required
dist: bionic
language: csharp
mono: none
dotnet: 2.0.0
python:
    - "3.6"
services: docker
script:
    - docker-compose build
before_deploy:
    echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
deploy:
    provider: script
    script:
        docker tag docker-to-aws-with-dotnet:latest leoaidar/docker-to-aws-with-dotnet:latest;
        docker push leoaidar/docker-to-aws-with-dotnet; 
    on:
        branch: master            
after_success:
    - sudo apt-get -y install python3-pip python-dev
    - sudo pip3 install -U setuptools
    - sudo pip3 install -U virtualenvwrapper
    - python3 -V
    - pip3 -V
    - pip3 uninstall wheel
    - pip3 install wheel
    - pip3 install awscli --upgrade --user
    - export PATH=$PATH:HOME/.local/bin
    - eval $(aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username $AWS_ACCESS_KEY_ID --password-stdin $AWS_SECRET_KEY_ID=997605063764.dkr.ecr.us-east-2.amazonaws.com)
    - docker tag docker-to-aws-with-dotnet:latest $IMAGE_REPO_URL:latest
    - docker push $IMAGE_REPO_URL:latest
notifications:
    email: false